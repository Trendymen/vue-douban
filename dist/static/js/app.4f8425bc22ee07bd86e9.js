webpackJsonp([1],{"+aT9":function(t,e){t.exports=AMap},"/4Fb":function(t,e){},"/TMx":function(t,e){},0:function(t,e){},EGi2:function(t,e){},GE4p:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n("EGi2"),n("p3C9"),n("MU8w");var i=n("7+uW"),a=n("NYxO"),s={changeVmin:function(t){t.vmin=Math.min(window.outerHeight,window.outerWidth)/100},changeCity:function(t,e){var n=e.city;t.city=n},changeBackUrl:function(t,e){var n=e.path;t.backUrl=n}},r=n("Xxa5"),o=n.n(r),c=n("//Fk"),u=n.n(c),l=n("exGp"),p=n.n(l),d=n("+aT9"),m=new(n.n(d).a.Geolocation)({});function v(t){return t&&(t instanceof u.a||"function"==typeof t.then)}var f=null,h={getCityName:function(t){var e=this,n=t.commit,i=(t.dispatch,t.state),a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p()(o.a.mark(function t(){var s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===i.city||a){t.next=2;break}return t.abrupt("return",u.a.resolve({city:i.city}));case 2:return v(f)||(f=new u.a(function(t,e){m.getCityInfo(function(n,i){console.log(i),"complete"===n&&t(i.city),"error"===n&&e(i.message)})})),t.next=5,f;case 5:return s=t.sent,n("changeCity",{city:"市"===String(s).slice(-1)?s.slice(0,-1):s}),f=null,t.abrupt("return",s);case 9:case"end":return t.stop()}},t,e)}))()}},g=n("Gu7T"),y=n.n(g),b=n("Dd8w"),w=n.n(b),_=n("+6Bu"),x=n.n(_),k=n("OvRC"),C=n.n(k);var R,L,V=n("YJeR"),E=n.n(V),F=(R=E.a,L=C()(null),R.forEach(function(t){L[t]=null}),L),O={getRatingList:function(t,e){var n=this,a=t.commit,s=(t.rootState,t.state),r=t.dispatch,c=e.type,u=e.refresh,l=void 0!==u&&u,d=x()(e,["type","refresh"]);return p()(o.a.mark(function t(){var e,u,p,m,f;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s[c].length,t.t0=v(F[c])&&!l,t.t0){t.next=5;break}return t.next=5,F[c];case 5:return t.t1=w.a,t.next=9,r("getCityName",null,{root:!0});case 9:t.t2=t.sent,t.t3={city:t.t2},t.t4=d,d=(0,t.t1)(t.t3,t.t4);case 13:return F[c]=(n="/movie/"+c,o={params:w()({},d,{start:l?0:s[c].length,count:d.count||10})},i.default.http.jsonp("https://api.douban.com/v2"+n,o).then(function(t){return t},function(t){console.log(t)})),t.next=16,F[c];case 16:return e=t.sent,u=e.body,p=u.count,m=u.subjects.length,f=u.subjects,F[c]=null,a("setRatingList",{type:c,refresh:l,data:f}),t.abrupt("return",{isEnd:m<p});case 24:case"end":return t.stop()}var n,o},t,n)}))()}},$={namespaced:!0,state:w()({},function(t){var e={};return t.forEach(function(t){e[t]=[]}),e}(E.a)),mutations:{setRatingList:function(t,e){var n,i=e.type,a=e.data;e.refresh?t[i]=a:(n=t[i]).push.apply(n,y()(a))}},actions:O};i.default.use(a.a);var U=new a.a.Store({strict:!1,state:{vmin:0,city:void 0,backUrl:""},mutations:s,actions:h,modules:{movieRatingList:$}}),S=n("/ocq"),j=n("7QTg"),M={name:"movie-item",props:{item:{required:!0,type:Object},index:{required:!0,type:Number},updated:{default:!1,type:Boolean},to:{default:"",type:String},isSlide:{default:!1,type:Boolean}},methods:{getStarPosition:function(t){return Math.round(t.rating.average)-10}},components:{swiperSlide:j.swiperSlide},watch:{}},N={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(t.isSlide?"swiper-slide":"div",{tag:"component",staticClass:"movie-item"},[n("router-link",{attrs:{to:t.to}},[n("div",{staticClass:"img-wp"},[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.item.images.small,expression:"item.images.small"}],key:t.updated,ref:"img",attrs:{alt:""}})]),t._v(" "),n("div",{staticClass:"info"},[n("p",[t._v(t._s(t.item.title))]),t._v(" "),n("p",{class:["rating",{none:!t.item.rating.average}]},[n("span",{directives:[{name:"show",rawName:"v-show",value:t.item.rating.average,expression:"item.rating.average"}],staticClass:"rating-star",style:{"background-position-y":t.getStarPosition(t.item)+"rem"}}),t._v(" "),n("span",[t._v(t._s(t.item.rating.average?t.item.rating.average.toFixed(1):"暂无评分"))])])])])],1)},staticRenderFns:[]};var I=n("VU/8")(M,N,!1,function(t){n("PM4f")},"data-v-32bad845",null).exports,T=(n("v2ns"),{name:"home-movie-list",props:{type:{required:!0,type:String}},data:function(){return{updated:!0,swiperOption:{slidesPerView:"auto",touchMoveStopPropagation:!0,freeMode:!0,mousewheel:!0,pagination:{el:".swiper-pagination",clickable:!0}}}},computed:w()({},Object(a.d)("movieRatingList",{list:function(t){return t[this.type].slice(0,10)}}),Object(a.d)({city:"city"})),components:{swiper:j.swiper,movieListItem:I},methods:w()({},Object(a.b)("movieRatingList",["getRatingList"]),{getList:function(t){return this.getRatingList(w()({type:this.type},t))},refreshFade:function(){var t=this;this.updated=!1,this.$nextTick(function(){t.updated=!0})}}),created:function(){this.getList(),console.log(this)},watch:{city:function(t,e){var n=this;return p()(o.a.mark(function i(){return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if("in_theaters"!==n.type||void 0===e){i.next=5;break}return console.log(t,e),i.next=4,n.getList({refresh:!0});case 4:n.refreshFade();case 5:case"end":return i.stop()}},i,n)}))()}}}),z={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home-movie-list-pane"},[n("p",{staticClass:"list-title"},[n("span",[t._t("title")],2),t._v(" "),n("button",{on:{click:function(e){t.$store.commit("changeCity",{city:"怀化"})}}},[t._v("change city")]),t._v(" "),n("router-link",{staticClass:"more",attrs:{to:{name:"movies-explore",params:{type:t.type}}}},[t._v("\n            更多\n        ")])],1),t._v(" "),n("swiper",{staticClass:"movie-list",attrs:{options:t.swiperOption}},t._l(t.list,function(e,i){return n("movie-list-item",{key:e.title,staticClass:"horizontal",attrs:{item:e,index:i,updated:t.updated,to:"/movie-detail/"+i,"is-slide":!0}})}))],1)},staticRenderFns:[]};var G=n("VU/8")(T,z,!1,function(t){n("/4Fb")},"data-v-60267bdc",null).exports,P={render:function(){var t=this.$createElement,e=this._self._c||t;return e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"show"}],staticClass:"fake-search-wrapper"},[e("div",{staticClass:"fake-search"},[e("span",[this._v("搜索电影")])])])])},staticRenderFns:[]};var B=n("VU/8")({name:"fake-search",data:function(){return{show:!0}},watch:{$route:function(t,e){this.show="home"===t.name||"search"===t.name||"movies-explore"===t.name}}},P,!1,function(t){n("/TMx")},"data-v-050d64b2",null).exports,q={name:"home",components:{movieList:G,fakeSearch:B},mounted:function(){}},H={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"movie-list-pane-wrapper"},[e("div",[e("movie-list",{attrs:{type:"in_theaters"}},[e("template",{slot:"title"},[this._v("正在热映")])],2),this._v(" "),e("movie-list",{attrs:{type:"coming_soon"}},[e("template",{slot:"title"},[this._v("即将上映")])],2)],1)])])},staticRenderFns:[]};var W=n("VU/8")(q,H,!1,function(t){n("GE4p")},"data-v-61642acc",null).exports,A=n("woOf"),J=n.n(A);function Y(t,e){!function(t,e){console.log(t.$data,e),J()(t.$data,e)}(t,x()(e,[]));var n=t.list.length;n<20&&t.getList({count:20-n})}var K={props:{},name:"movies-explore",components:{fakeSearch:B,movieListItem:I},data:function(){return{updated:!1,type:null}},computed:w()({},Object(a.d)("movieRatingList",{list:function(t){return t[this.type]}})),methods:w()({},Object(a.b)("movieRatingList",["getRatingList"]),{getList:function(t){return this.getRatingList(w()({type:this.type},t))}}),beforeRouteEnter:function(t,e,n){n(function(e){Y(e,{type:t.params.type})})},beforeRouteUpdate:function(t,e,n){Y(this,{type:t.params.type}),n()}},D={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"wrapper"},[e("div",{staticClass:"movies-explore-wrapper"},[e("el-row",{staticClass:"movie-list",attrs:{gutter:25,tag:"ul"}},this._l(this.list,function(t,n){return e("el-col",{key:t.title,staticClass:"movie-item",attrs:{xs:8,sm:6,md:4,tag:"li"}},[e("movie-list-item",{attrs:{item:t,index:n,to:"/movie-detail/"+n}})],1)}))],1)])},staticRenderFns:[]};var Q=n("VU/8")(K,D,!1,function(t){n("cIbV")},"data-v-0070a0c2",null).exports,X={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"not-found"},[e("p",{staticClass:"notice-chinese"},[this._v("没有找到这个东西")]),this._v(" "),e("p",[this._v("o(╥﹏╥)o")]),this._v(" "),e("router-link",{staticClass:"el-button--success",attrs:{to:{name:"home"},tag:"el-button"}},[this._v("点击这里返回首页")])],1)},staticRenderFns:[]};var Z=n("VU/8")({name:"not-found"},X,!1,function(t){n("mVKf")},"data-v-99372980",null).exports;i.default.use(S.a);var tt,et=new S.a({routes:[{path:"/",name:"home",component:W,meta:{toHome:!1}},{path:"/explore/:type("+E.a.join("|")+")",name:"movies-explore",component:Q,props:function(t){return{type:t.params.type}}},{name:"not-found",path:"*",component:Z}],scrollBehavior:function(t,e,n){return new u.a(function(t,e){setTimeout(function(){console.log(n),t(n||{x:0,y:0})},400)})},mode:"hash",base:(tt=location.pathname,["/vue-douban/","/vue-douban/dist/","/douban/dist/"].find(function(t){return tt.includes(t)})||"/")});et.beforeEach(function(t,e,n){var i=e.name,a=e.path;U.commit("changeBackUrl",{path:i&&"/"!==a?"":"/"}),n()});var nt=et,it=n("8+8L"),at=n("cTzj"),st=n.n(at),rt=n("zL8q"),ot=n.n(rt),ct=(n("tvR6"),n("3EgV")),ut=n.n(ct),lt=n("e45v"),pt=n.n(lt),dt={name:"nav-header",data:function(){return{isFixed:!1}},components:{fakeSearch:B},computed:w()({},Object(a.d)(["backUrl"])),methods:{searchFade:function(){var t=this;window.IntersectionObserver&&(console.log(IntersectionObserver),new IntersectionObserver(function(e,n){var i=e[0].intersectionRatio;t.isFixed=i<36/66},{threshold:36/66}).observe(this.$refs.navigator))},back:function(){this.backUrl?this.$router.push({path:this.backUrl}):this.$router.go(-1)}},beforeCreate:function(){},mounted:function(){},directives:{sticky:pt.a}},mt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("header",{directives:[{name:"sticky",rawName:"v-sticky",value:{zIndex:999,stickyTop:0,disabled:!1},expression:"{zIndex:999,stickyTop:0,disabled:false}"}],ref:"navigator",staticClass:"navigator",class:{fixed:t.isFixed}},[n("div",{staticClass:"sticky-wrapper"},["home"!==t.$route.name?n("a",{on:{click:t.back}},[t._v("\n            "+t._s("home"!==t.$route.name?"返回":"")+"\n        ")]):n("span"),t._v(" "),n("h1",{staticClass:"title"},[t._v("\n            豆瓣电影\n        ")]),t._v(" "),n("a")])])},staticRenderFns:[]};var vt=n("VU/8")(dt,mt,!1,function(t){n("V2hI")},"data-v-a99933ee",null).exports,ft=n("M4fF"),ht=n.n(ft),gt=Object(a.c)(["changeVmin"]).changeVmin,yt=ht.a.debounce(gt,250),bt={name:"App",created:function(){this.changeVmin()},mounted:function(){window.addEventListener("resize",this.getVmin)},methods:w()({},Object(a.b)(["getCityName"]),{changeVmin:gt,getVmin:yt}),components:{navHeader:vt,fakeSearch:B}},wt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("el-container",{attrs:{id:"app",direction:"vertical"}},[e("nav-header"),this._v(" "),e("el-main",[e("fake-search"),this._v(" "),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("keep-alive",[e("router-view",{staticClass:"main-panel"})],1)],1)],1)],1)},staticRenderFns:[]};var _t=n("VU/8")(bt,wt,!1,function(t){n("aNWM")},"data-v-096c5abe",null).exports;i.default.use(it.a),i.default.use(st.a,{preLoad:1.5,attempt:5}),i.default.use(ot.a),i.default.use(ut.a),i.default.config.productionTip=!1,new i.default({el:"#app",router:nt,store:U,components:{App:_t}})},PM4f:function(t,e){},V2hI:function(t,e){},YJeR:function(t,e){t.exports=["in_theaters","coming_soon"]},aNWM:function(t,e){},cIbV:function(t,e){},mVKf:function(t,e){},tvR6:function(t,e){},v2ns:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.4f8425bc22ee07bd86e9.js.map