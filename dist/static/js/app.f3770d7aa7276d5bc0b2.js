webpackJsonp([1],{"+aT9":function(t,e){t.exports=AMap},0:function(t,e){},"7zck":function(t,e){},EGi2:function(t,e){},Exlg:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n("j1ja"),n("p3C9");var i=n("7+uW"),a=n("NYxO"),s={changeVmin:function(t){t.vmin=Math.min(window.outerHeight,window.outerWidth)/100},changeCity:function(t,e){var n=e.city;t.city=n},changeBackUrl:function(t,e){var n=e.path;t.backUrl=n}},r=n("Xxa5"),o=n.n(r),c=n("//Fk"),u=n.n(c),l=n("exGp"),p=n.n(l),m=n("+aT9"),v=n.n(m),d=void 0;try{d=new v.a.Geolocation({})}catch(t){console.log("AMP加载失败")}function f(t){return t&&(t instanceof u.a||"function"==typeof t.then)}var h=null,g={getCityName:function(t){var e=this,n=t.commit,i=(t.dispatch,t.state),a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p()(o.a.mark(function t(){var s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===i.city||a){t.next=2;break}return t.abrupt("return",u.a.resolve({city:i.city}));case 2:return f(h)||(h=new u.a(function(t,e){d.getCityInfo(function(n,i){console.log(i),"complete"===n&&t(i.city),"error"===n&&e(i.message)})})),t.next=5,h;case 5:return s=t.sent,n("changeCity",{city:"市"===String(s).slice(-1)?s.slice(0,-1):s}),h=null,t.abrupt("return",s);case 9:case"end":return t.stop()}},t,e)}))()}},y=n("Gu7T"),b=n.n(y),w=n("Dd8w"),_=n.n(w),x=n("+6Bu"),k=n.n(x),C=n("OvRC"),R=n.n(C);function L(t){this.name="APILimitError",this.message=t,this.stack=(new Error).stack}L.prototype=R()(Error.prototype),L.prototype.constructor=L;var E=0,V=function(t){return E=0,t},O=function(t){throw E<5?E++:setTimeout(function(){E=0},1e3),new L("API访问次数达到上限")};var j,F,$=n("YJeR"),S=n.n($),U=(j=S.a,F=R()(null),j.forEach(function(t){F[t]=null}),F),N={getRatingList:function(t,e){var n=this,a=t.commit,s=(t.rootState,t.state),r=t.dispatch,c=e.type,u=e.refresh,l=void 0!==u&&u,m=k()(e,["type","refresh"]);return p()(o.a.mark(function t(){var e,u,p,v;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=_.a,t.next=4,r("getCityName",null,{root:!0});case 4:t.t1=t.sent,t.t2={city:t.t1},t.t3=m,m=(0,t.t0)(t.t2,t.t3);case 8:if(t.t4=f(U[c])&&!l,!t.t4){t.next=12;break}return t.next=12,U[c];case 12:return s[c].length,U[c]=(n="/movie/"+c,o={params:_()({},m,{start:l?0:s[c].length,count:m.count||10})},i.default.http.jsonp("https://api.douban.com/v2"+n,o).then(V,O)),t.prev=14,t.next=17,U[c];case 17:return e=t.sent,u=e.body,p=u.total,u.subjects.length,v=u.subjects,a("setRatingList",{type:c,refresh:l,data:v}),U[c]=void 0,t.abrupt("return",{isEnd:!(s[c].length<p)});case 27:if(t.prev=27,t.t5=t.catch(14),U[c]=void 0,!(t.t5 instanceof L)){t.next=33;break}return console.log(t.t5),t.abrupt("return",{error:!0,isEnd:!1});case 33:case"end":return t.stop()}var n,o},t,n,[[14,27]])}))()}},M={namespaced:!0,state:_()({},function(t){var e={};return t.forEach(function(t){e[t]=[]}),e}(S.a)),mutations:{setRatingList:function(t,e){var n,i=e.type,a=e.data;e.refresh?t[i]=a:(n=t[i]).push.apply(n,b()(a))}},actions:N};i.default.use(a.a);var T=new a.a.Store({strict:!1,state:{vmin:0,city:void 0,backUrl:""},mutations:s,actions:g,modules:{movieRatingList:M}}),P=n("/ocq"),I=n("7QTg"),z={name:"movie-item",props:{item:{required:!0,type:Object},index:{required:!0,type:Number},updated:{default:!1,type:Boolean},to:{default:"",type:String},isSlide:{default:!1,type:Boolean}},methods:{getStarPosition:function(t){return Math.round(t.rating.average)-10}},components:{swiperSlide:I.swiperSlide},watch:{}},J={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(t.isSlide?"swiper-slide":"div",{tag:"component",staticClass:"movie-item"},[n("router-link",{attrs:{to:t.to}},[n("div",{staticClass:"img-wp"},[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.item.images.small,expression:"item.images.small"}],key:t.updated,ref:"img",attrs:{alt:""}})]),t._v(" "),n("div",{staticClass:"movie-info"},[n("p",[t._v(t._s(t.item.title))]),t._v(" "),n("p",{class:["rating",{none:!t.item.rating.average}]},[n("span",{directives:[{name:"show",rawName:"v-show",value:t.item.rating.average,expression:"item.rating.average"}],staticClass:"rating-star",style:{"background-position-y":t.getStarPosition(t.item)+"rem"}}),t._v(" "),n("span",[t._v(t._s(t.item.rating.average?t.item.rating.average.toFixed(1):"暂无评分"))])])])])],1)},staticRenderFns:[]};var A=n("VU/8")(z,J,!1,function(t){n("fKfR")},"data-v-6e819236",null).exports,B=(n("v2ns"),{name:"home-movie-list",props:{type:{required:!0,type:String}},data:function(){return{updated:!0,swiperOption:{slidesPerView:"auto",touchMoveStopPropagation:!0,freeMode:!0,mousewheel:!0,pagination:{el:".swiper-pagination",clickable:!0}}}},computed:_()({},Object(a.d)("movieRatingList",{list:function(t){return t[this.type].slice(0,10)}}),Object(a.d)({city:"city"})),components:{swiper:I.swiper,movieListItem:A},methods:_()({},Object(a.b)("movieRatingList",["getRatingList"]),{getList:function(t){return this.getRatingList(_()({type:this.type},t))},refreshFade:function(){var t=this;this.updated=!1,this.$nextTick(function(){t.updated=!0})}}),created:function(){this.getList(),console.log(this)},watch:{city:function(t,e){var n=this;return p()(o.a.mark(function i(){return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if("in_theaters"!==n.type||void 0===e){i.next=5;break}return console.log(t,e),i.next=4,n.getList({refresh:!0});case 4:n.refreshFade();case 5:case"end":return i.stop()}},i,n)}))()}}}),q={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home-movie-list-pane"},[n("p",{staticClass:"list-title"},[n("span",[t._t("title")],2),t._v(" "),n("router-link",{staticClass:"more",attrs:{to:{name:"movies-explore",params:{type:t.type}}}},[t._v("\n            更多\n        ")])],1),t._v(" "),n("swiper",{staticClass:"movie-list",attrs:{options:t.swiperOption}},t._l(t.list,function(e,i){return n("movie-list-item",{key:e.title,staticClass:"horizontal",attrs:{item:e,index:i,updated:t.updated,to:"/movie-detail/"+i,"is-slide":!0}})}))],1)},staticRenderFns:[]};var G=n("VU/8")(B,q,!1,function(t){n("VJ1u")},"data-v-d08a4c00",null).exports,H={render:function(){var t=this.$createElement,e=this._self._c||t;return e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"show"}],staticClass:"fake-search-wrapper"},[e("div",{staticClass:"fake-search"},[e("span",[this._v("搜索电影")])])])])},staticRenderFns:[]};var W=n("VU/8")({name:"fake-search",data:function(){return{show:!0}},watch:{$route:function(t,e){this.show="home"===t.name||"search"===t.name||"movies-explore"===t.name}}},H,!1,function(t){n("yevt")},"data-v-7d26f050",null).exports,D={name:"home",components:{movieList:G,fakeSearch:W},mounted:function(){}},Q={render:function(){var t=this.$createElement,e=this._self._c||t;return e("v-container",{staticClass:"container",attrs:{fluid:""}},[e("div",{staticClass:"movie-list-pane-wrapper"},[e("movie-list",{attrs:{type:"in_theaters"}},[e("template",{slot:"title"},[this._v("正在热映")])],2),this._v(" "),e("movie-list",{attrs:{type:"coming_soon"}},[e("template",{slot:"title"},[this._v("即将上映")])],2)],1)])},staticRenderFns:[]};var Y=n("VU/8")(D,Q,!1,function(t){n("Exlg")},"data-v-69abc797",null).exports,K=n("woOf"),Z=n.n(K);function X(t,e){!function(t,e){Z()(t.$data,e)}(t,k()(e,[]));var n=t.list.length;n<20&&t.getList({count:20-n})}var tt={props:{},name:"movies-explore",components:{fakeSearch:W,movieListItem:A},data:function(){return{loading:{},type:null,typeName:{in_theaters:"正在热映",coming_soon:"即将上映"}}},computed:_()({},Object(a.d)("movieRatingList",{list:function(t){return t[this.type]}})),beforeCreate:function(){},created:function(){},methods:_()({},Object(a.b)("movieRatingList",["getRatingList"]),{getList:function(t){var e=this;this.loading[this.type]||(this.loading[this.type]=!0,this.getRatingList(_()({type:this.type},t)).then(function(t){var n=t.isEnd;e.loading[e.type]=n}))}}),beforeRouteEnter:function(t,e,n){n(function(e){X(e,{type:t.params.type})})},beforeRouteUpdate:function(t,e,n){X(this,{type:t.params.type}),n()}},et={render:function(){var t,e=this,n=e.$createElement,i=e._self._c||n;return i("v-layout",{staticClass:"container",attrs:{column:""}},[i("h1",{staticClass:"title"},[e._v(e._s(e.typeName[e.type]))]),e._v(" "),i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.getList,expression:"getList"}],attrs:{"infinite-scroll-disabled":!1,"infinite-scroll-distance":"10","infinite-scroll-immediate-check":"false"}},[i("v-container",e._b({staticClass:"movies-explore-wrapper",attrs:{fluid:""}},"v-container",(t={},t["grid-list-"+(e.$vuetify.breakpoint.width>1264?e.$vuetify.breakpoint.name:"lg")]=!0,t),!1),[i("v-layout",{staticClass:"movie-list",attrs:{row:"",wrap:"",tag:"ul",fluid:""}},e._l(e.list,function(t,e){return i("v-flex",{key:t.title,staticClass:"movie-item",attrs:{xs4:"",sm3:"",md2:"",tag:"li"}},[i("movie-list-item",{attrs:{item:t,index:e,to:"/movie-detail/"+e}})],1)}))],1)],1)])},staticRenderFns:[]};var nt=n("VU/8")(tt,et,!1,function(t){n("tZNV")},"data-v-0b352490",null).exports,it={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"not-found"},[e("p",{staticClass:"notice-chinese"},[this._v("没有找到这个东西")]),this._v(" "),e("p",[this._v("o(╥﹏╥)o")]),this._v(" "),e("v-btn",{staticClass:"el-button--success",attrs:{to:{name:"home"},tag:"v-btn ",color:"success"}},[this._v("\n        点击这里返回首页\n    ")])],1)},staticRenderFns:[]};var at=n("VU/8")({name:"not-found"},it,!1,function(t){n("mOsV")},"data-v-dff9309c",null).exports;i.default.use(P.a);var st,rt=new P.a({routes:[{path:"/",name:"home",component:Y,meta:{toHome:!1}},{path:"/explore/:type("+S.a.join("|")+")",name:"movies-explore",component:nt,props:function(t){return{type:t.params.type}}},{name:"not-found",path:"*",component:at}],scrollBehavior:function(t,e,n){return new u.a(function(t,e){setTimeout(function(){console.log(n),t(n||{x:0,y:0})},300)})},mode:"hash",base:(st=location.pathname,["/vue-douban/","/vue-douban/dist/","/douban/dist/"].find(function(t){return st.includes(t)})||"/")});rt.beforeEach(function(t,e,n){var i=e.name,a=e.path;T.commit("changeBackUrl",{path:i&&"/"!==a?"":"/"}),n()});var ot=rt,ct=n("8+8L"),ut=n("cTzj"),lt=n.n(ut),pt=n("bqTm"),mt=n.n(pt),vt=(n("tvR6"),n("3EgV")),dt=n.n(vt),ft=(n("gJtD"),n("7zck"),n("EGi2"),{name:"nav-header",data:function(){return{isFixed:!1}},components:{fakeSearch:W},computed:_()({},Object(a.d)(["backUrl"])),methods:{searchFade:function(){var t=this;window.IntersectionObserver&&(console.log(IntersectionObserver),new IntersectionObserver(function(e,n){var i=e[0].intersectionRatio;t.isFixed=i<36/66},{threshold:36/66}).observe(this.$refs.navigator))},back:function(){this.backUrl?this.$router.push({path:this.backUrl}):this.$router.go(-1)}},beforeCreate:function(){},mounted:function(){}}),ht={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-toolbar",{ref:"navigator",staticClass:"navigator",class:{fixed:t.isFixed},attrs:{app:"",flat:""}},[n("span",[n("v-btn",{staticClass:"toolbar-btn",attrs:{icon:""},on:{click:t.back}},["home"!==t.$route.name?n("v-icon",[t._v("\n            arrow_back\n        ")]):t._e()],1)],1),t._v(" "),n("v-toolbar-title",{staticClass:"toolbar-title",domProps:{textContent:t._s("豆瓣电影")}}),t._v(" "),n("a")],1)},staticRenderFns:[]};var gt=n("VU/8")(ft,ht,!1,function(t){n("QM1w")},"data-v-17c90bd2",null).exports,yt=n("M4fF"),bt=n.n(yt),wt=Object(a.c)(["changeVmin"]).changeVmin,_t=bt.a.debounce(wt,250),xt={name:"App",created:function(){this.changeVmin()},mounted:function(){window.addEventListener("resize",this.getVmin)},methods:_()({},Object(a.b)(["getCityName"]),{changeVmin:wt,getVmin:_t}),components:{navHeader:gt,fakeSearch:W}},kt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("v-app",{attrs:{id:"app",direction:"vertical"}},[e("nav-header"),this._v(" "),e("v-content",[e("fake-search"),this._v(" "),e("transition",{attrs:{name:"fade",mode:"out-in"}},[e("keep-alive",[e("router-view",{staticClass:"main-panel"})],1)],1)],1)],1)},staticRenderFns:[]};var Ct=n("VU/8")(xt,kt,!1,function(t){n("RbWn")},null,null).exports;i.default.use(ct.a),i.default.use(mt.a),i.default.use(lt.a,{preLoad:1.5,attempt:5,observer:!0}),i.default.use(dt.a),i.default.config.productionTip=!1,new i.default({el:"#app",router:ot,store:T,components:{App:Ct}})},QM1w:function(t,e){},RbWn:function(t,e){},VJ1u:function(t,e){},YJeR:function(t,e){t.exports=["in_theaters","coming_soon"]},fKfR:function(t,e){},gJtD:function(t,e){},mOsV:function(t,e){},tZNV:function(t,e){},tvR6:function(t,e){},v2ns:function(t,e){},yevt:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.f3770d7aa7276d5bc0b2.js.map